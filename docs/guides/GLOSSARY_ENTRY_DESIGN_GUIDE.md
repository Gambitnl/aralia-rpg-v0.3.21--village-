# Guide: Designing Glossary Entries

This guide outlines the structure, content, and styling conventions for creating and updating glossary entries in the Aralia RPG application, using spell and rule entries as primary examples.

## 1. File Structure Overview

*   **Content Source**: All glossary content files are Markdown files (`.md`) located in subdirectories under `public/data/glossary/entries/`. This is the single source of truth.
*   **Organization**: Entries are organized by category into subdirectories (e.g., `spells/`, `rules/`, `classes/`).
*   **Index Files**: The `GlossaryProvider` uses JSON index files located in `public/data/glossary/index/` to find and load the content. These are generated by a script.

## 2. Markdown File Naming and Creation/Update

*   **Convention**: `[id_kebab_case].md`. The filename must use kebab-case (e.g., `healing-word.md`, not `healing_word.md`).
*   **Action**: Before creating a new file, check if a file for that term already exists. If it does, update the existing file. If not, create a new one. The filename (without `.md`) should exactly match the `id` field in the frontmatter.

<div class="glossary-callout" style="border-left-color: #60a5fa;"> <!-- blue-500 -->
  <h4 style="color: #93c5fd;">Recommended Workflow</h4>
  <p>For adding new spells, it's highly recommended to use the `add_spell.js` script. This script automatically creates both the `.json` data file and the `.md` glossary entry with the correct templates and updates all necessary indexes. See the <span data-term-id="spell_addition_workflow_guide" class="glossary-term-link-from-markdown">Spell Addition Workflow Guide</span> for details.</p>
</div>

## 3. YAML Frontmatter (Required)

Every entry must begin with YAML frontmatter.

```yaml
---
id: "healing-word"  # Required: Unique kebab-case ID, MUST match filename
title: "Healing Word" # Required: Human-readable display title
category: "Spells" # Required: The category for organization (e.g., "Spells", "Rules Glossary")
tags: ["level 1", "evocation", "healing", "bonus action"] # Optional: Keywords for search
excerpt: "A creature of your choice that you can see within range regains hit points equal to 1d4 + your spellcasting ability modifier." # Optional: A short summary for tooltips
seeAlso: ["cure_wounds", "bonus_actions"] # Optional: IDs of related glossary terms
filePath: "/data/glossary/entries/spells/healing-word.md" # Required: Public fetchable path. MUST be correct.
---
```

<div class="glossary-callout" style="border-left-color: #f87171;"> <!-- red-500 -->
  <h4 style="color: #fca5a5;">⚠️ Critical: File Integrity Checks</h4>
  <p>The glossary generation script performs several checks. It will fail if:</p>
  <ul>
    <li>An entry is missing a required frontmatter field (`id`, `title`, `category`, `filePath`).</li>
    <li>The `id` field does not exactly match the filename (e.g., `id: "healing_word"` in `healing-word.md` will fail).</li>
    <li>Two or more entries share the same `id`.</li>
    <li>The `filePath` does not accurately point to the file's location within the `/public` directory.</li>
  </ul>
  <p>A failure in the script will prevent the glossary indexes from being updated, which can lead to application errors.</p>
</div>

<div class="glossary-callout" style="border-left-color: #fbbf24;"> <!-- amber-400 -->
  <h4 style="color: #fcd34d;">Troubleshooting Guide</h4>
  <p>If the application fails to load with a JSON parsing error (e.g., "Unexpected non-whitespace character" or "Unterminated string"), or if a glossary link results in a "404 Not Found" error, the root cause is almost always a mistake in one of the source `.md` files.</p>
  <p>Carefully check the frontmatter of your most recently edited glossary files for syntax errors (like a misplaced colon) or mismatches between the `id` and the filename.</p>
</div>

## 4. Content Structure for Spell Entries

After the frontmatter, use the following custom HTML block to display the spell's information in the modern card format. This specific structure is styled by global CSS in `index.html`.

### a. Spell Card HTML Template
<div class="glossary-callout">
  <h4 style="color: #60a5fa;">Note: No Duplicate Title</h4>
  <p>When using the <code>&lt;div class="spell-card"&gt;</code> template below, **do not** add a separate Markdown heading like <code># Spell Name</code>. The title is already handled by the <code>&lt;h1 class="spell-card-title"&gt;</code> element inside the template.</p>
</div>

```html
<div class="spell-card">
  <div class="spell-card-header">
    <h1 class="spell-card-title">Shield of Faith</h1>
    <div class="spell-card-symbol" title="Concentration"><span class="spell-card-symbol-inner">C</span></div>
  </div>
  <div class="spell-card-divider"></div>
  <div class="spell-card-stats-grid">
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Level</span>
      <span class="spell-card-stat-value">1st</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Casting Time</span>
      <span class="spell-card-stat-value">1 Bonus Action</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Range/Area</span>
      <span class="spell-card-stat-value">60 ft.</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Components</span>
      <span class="spell-card-stat-value">V, S, M *</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Duration</span>
      <span class="spell-card-stat-value"><div class="concentration-icon"></div> 10 Minutes</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">School</span>
      <span class="spell-card-stat-value">Abjuration</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Attack/Save</span>
      <span class="spell-card-stat-value">None</span>
    </div>
    <div class="spell-card-stat">
      <span class="spell-card-stat-label">Damage/Effect</span>
      <span class="spell-card-stat-value">Buff</span>
    </div>
  </div>
  <div class="spell-card-divider"></div>
  <p class="spell-card-description">
    A shimmering field surrounds a creature of your choice within range, granting it a +2 bonus to AC for the duration.
  </p>
  <p class="spell-card-material-note">
    * - (a small piece of parchment with a bit of holy text written on it)
  </p>
  <div class="spell-card-tags-section">
    <span class="spell-card-tags-label">Spell Tags:</span>
    <span class="spell-card-tag">BUFF</span>
    <span class="spell-card-tag">WARDING</span>
  </div>
  <div class="spell-card-tags-section">
    <span class="spell-card-tags-label">Available For:</span>
    <span class="spell-card-tag">CLERIC</span>
    <span class="spell-card-tag">PALADIN</span>
  </div>
</div>
```

### b. Customizing the Template
*   **Concentration Symbol**:
    *   To show the Concentration diamond in the header, include `<div class="spell-card-symbol" title="Concentration"><span class="spell-card-symbol-inner">C</span></div>`.
    *   To show it next to the duration, include `<div class="concentration-icon"></div>` before the duration text.
*   **Material Components**: If the spell has a material component note (like `M *`), add the description in a `<p class="spell-card-material-note">`.
*   **Tags**: Add or remove `<span class="spell-card-tag">...</span>` elements as needed for "Spell Tags" and "Available For" sections.

## 5. Content Structure for Rule Entries

Rule entries are simpler and generally use standard Markdown.

### a. Main Title (H1)
```markdown
# D20 Tests
```

### b. Content Body
*   Write the rule description using standard Markdown paragraphs, lists, and tables.
*   Use `##` and `###` for subheadings. The `GlossaryContentRenderer` will automatically turn `###` headings into collapsible `<details>` sections.
*   Use internal links (`<span data-term-id="...">`) for related terms.

## 6. Creating Hierarchical Entries (e.g., D20 Tests)

To create a nested menu in the glossary sidebar, you must **manually edit the JSON index file**.

1.  **Create All Files**: Create the Markdown files for the parent entry (e.g., `d20_test.md`) and all its children (e.g., `ability_check.md`, `ability_check_modifier.md`).
2.  **Run Indexer Script**: After creating the files, run `node scripts/generateGlossaryIndex.js`. This will add all your new entries to the appropriate category index file (e.g., `rules_glossary.json`) at the top level.
3.  **Manually Edit the JSON Index**:
    *   Open the relevant JSON file (e.g., `public/data/glossary/index/rules_glossary.json`).
    *   Find the JSON object for your **parent** entry.
    *   Create a new key on the parent object called `"subEntries"` and set its value to an empty array `[]`.
    *   Find the JSON objects for your **child** entries within the same file.
    *   **Cut** the child entry objects from the main array.
    *   **Paste** the child entry objects into the `subEntries` array of the parent object. You can nest this structure multiple levels deep.

**Example of Final JSON Structure:**
```json
[
  {
    "id": "d20_test",
    "title": "D20 Tests",
    "filePath": "/data/glossary/entries/rules/d20_test.md",
    "subEntries": [
      {
        "id": "ability_check",
        "title": "Ability Checks",
        "filePath": "/data/glossary/entries/rules/ability_check.md",
        "subEntries": [
          {
            "id": "ability_check_modifier",
            "title": "Ability Modifier",
            "filePath": "/data/glossary/entries/rules/ability_check_modifier.md"
          }
        ]
      }
    ]
  }
]
```

## 7. Final Step: Updating the Application

After adding or modifying any glossary `.md` files, you **must run the indexer script** (`node scripts/generateGlossaryIndex.js`). This script updates the JSON index files that the application uses to load and display glossary content. Without this step, your changes will not appear in the application.
